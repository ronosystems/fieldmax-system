<!-- templates/staff/dashboards/store_manager_dashboard.html -->
{% extends 'inventory/staff_base.html' %}
{% load static %}

{% block title %}Store Manager Dashboard - FieldMax{% endblock %}

{% block extra_css %}
<style>
    .welcome-card {
        background: linear-gradient(135deg, #0331ff 0%, #070bee 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    }
    
    .welcome-title {
        font-size: 2.2rem;
        font-weight: 700;
        margin-bottom: 10px;
    }
    
    .welcome-subtitle {
        opacity: 0.9;
        font-size: 1.1rem;
    }
    
    .date-badge {
        background: rgba(255,255,255,0.2);
        padding: 8px 15px;
        border-radius: 50px;
        display: inline-block;
        margin-top: 15px;
    }
    
    .quick-stats {
        display: flex;
        gap: 20px;
        margin-top: 20px;
        flex-wrap: wrap;
    }
    
    .quick-stat-item {
        background: rgba(255,255,255,0.1);
        padding: 15px 25px;
        border-radius: 12px;
        backdrop-filter: blur(10px);
        flex: 1;
        min-width: 150px;
        text-align: center;
    }
    
    .quick-stat-value {
        font-size: 1.8rem;
        font-weight: 700;
        line-height: 1;
    }
    
    .quick-stat-label {
        font-size: 0.85rem;
        opacity: 0.8;
        margin-top: 5px;
    }
    
    .action-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
    }
    
    .action-card {
        background: white;
        border-radius: 12px;
        padding: 20px 15px;
        text-align: center;
        text-decoration: none;
        color: #333;
        transition: all 0.3s;
        border: 1px solid #e0e0e0;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    
    .action-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(102, 126, 234, 0.2);
        border-color: #667eea;
    }
    
    .action-card i {
        font-size: 2rem;
        margin-bottom: 10px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    
    .action-card span {
        display: block;
        font-weight: 600;
        font-size: 0.9rem;
        margin-bottom: 5px;
    }
    
    .action-card small {
        color: #666;
        font-size: 0.75rem;
    }
    
    .chart-container {
        background: white;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        height: 100%;
    }
    
    .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
    }
    
    .chart-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #333;
        margin: 0;
    }
    
    .chart-title i {
        color: #667eea;
        margin-right: 8px;
    }
    
    .chart-wrapper {
        height: 250px;
        position: relative;
    }
    
    .progress-custom {
        height: 8px;
        border-radius: 4px;
        background: #f0f0f0;
        overflow: hidden;
        margin-top: 8px;
    }
    
    .progress-bar-custom {
        height: 100%;
        background: linear-gradient(90deg, #667eea, #764ba2);
        border-radius: 4px;
    }
    
    .badge-trend-up {
        background: #d4edda;
        color: #155724;
        padding: 3px 8px;
        border-radius: 50px;
        font-size: 0.7rem;
        font-weight: 600;
    }
    
    .badge-trend-down {
        background: #f8d7da;
        color: #721c24;
        padding: 3px 8px;
        border-radius: 50px;
        font-size: 0.7rem;
        font-weight: 600;
    }
    
    .alert-item {
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 10px;
        border-left: 4px solid;
        transition: all 0.3s;
    }
    
    .alert-item:hover {
        transform: translateX(5px);
    }
    
    .alert-item.warning {
        background: #fff3cd;
        border-left-color: #ffc107;
    }
    
    .alert-item.danger {
        background: #f8d7da;
        border-left-color: #dc3545;
    }
    
    .alert-item.success {
        background: #d4edda;
        border-left-color: #28a745;
    }
    
    .activity-timeline {
        position: relative;
        padding-left: 30px;
    }
    
    .activity-item {
        position: relative;
        padding-bottom: 20px;
        border-left: 2px solid #e0e0e0;
        padding-left: 20px;
        margin-left: 10px;
    }
    
    .activity-item:last-child {
        border-left: none;
    }
    
    .activity-icon {
        position: absolute;
        left: -34px;
        top: 0;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: white;
        border: 2px solid #667eea;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #667eea;
    }
    
    .activity-content {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 10px;
    }
    
    .activity-time {
        font-size: 0.75rem;
        color: #666;
        margin-bottom: 5px;
    }
    
    .return-card {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 15px;
        transition: all 0.3s;
    }
    
    .return-card:hover {
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .return-status {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
    }
    
    .status-pending { background: #ffc107; }
    .status-verified { background: #17a2b8; }
    .status-approved { background: #28a745; }
    .status-rejected { background: #dc3545; }
    
    .inventory-status {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 5px;
    }
    
    .status-normal { background: #28a745; }
    .status-low { background: #ffc107; }
    .status-critical { background: #dc3545; }
    
    @media (max-width: 768px) {
        .welcome-title {
            font-size: 1.5rem;
        }
        
        .quick-stats {
            flex-direction: column;
        }
        
        .quick-stat-item {
            width: 100%;
        }
        
        .action-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
</style>
{% endblock %}

{% block page_icon %}fas fa-store{% endblock %}

{% block page_title %}Store Manager Dashboard{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'staff:store_manager_dashboard' %}">Dashboard</a></li>
<li class="breadcrumb-item active">Overview</li>
{% endblock %}

{% block page_actions %}
<div class="btn-group">
    <a href="{% url 'inventory:product_add' %}" class="btn btn-primary-custom btn-custom">
        <i class="fas fa-plus-circle me-2"></i>Add Product
    </a>
    <button type="button" class="btn btn-outline-custom btn-custom dropdown-toggle" data-bs-toggle="dropdown">
        <i class="fas fa-download"></i>
    </button>
    <ul class="dropdown-menu dropdown-menu-end">
        <li><h6 class="dropdown-header">Export Dashboard</h6></li>
        <li><a class="dropdown-item" href="#"><i class="fas fa-file-pdf me-2 text-danger"></i>PDF Report</a></li>
        <li><a class="dropdown-item" href="#"><i class="fas fa-file-excel me-2 text-success"></i>Excel Report</a></li>
        <li><a class="dropdown-item" href="#"><i class="fas fa-print me-2 text-secondary"></i>Print</a></li>
    </ul>
</div>
{% endblock %}

{% block content %}
<!-- Welcome Section -->
<div class="welcome-card animate__animated animate__fadeIn">
    <div class="row align-items-center">
        <div class="col-lg-8">
            <h1 class="welcome-title">
                <i class="fas fa-store me-3"></i>Store Manager Dashboard
            </h1>
            <p class="welcome-subtitle">
                <i class="fas fa-calendar-alt me-2"></i>{{ today|date:"l, F j, Y" }}
                <span class="mx-2">|</span>
                <i class="fas fa-clock me-2"></i>{{ today|time:"H:i" }}
            </p>
            
            <div class="date-badge">
                <i class="fas fa-chart-line me-2"></i>
                <strong>{{ total_products|default:"0" }}</strong> total products |
                <strong>{{ low_stock_products|default:"0" }}</strong> low stock |
                <strong>KES {{ total_stock_value|floatformat:0 }}</strong> value
            </div>

            <div class="quick-stats">
                <div class="quick-stat-item">
                    <div class="quick-stat-value">{{ new_products_week|default:"0" }}</div>
                    <div class="quick-stat-label">New This Week</div>
                </div>
                <div class="quick-stat-item">
                    <div class="quick-stat-value">{{ available_products|default:"0" }}</div>
                    <div class="quick-stat-label">Available</div>
                </div>
                <div class="quick-stat-item">
                    <div class="quick-stat-value">{{ sold_products|default:"0" }}</div>
                    <div class="quick-stat-label">Sold</div>
                </div>
            </div>
        </div>
        <div class="col-lg-4 text-lg-end mt-4 mt-lg-0">
            <img src="{% static 'images/LOGO.jpg' %}?v=2" alt="FieldMax" class="img-fluid" style="opacity: 0.8;">
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="action-grid">
    <a href="{% url 'inventory:product_add' %}" class="action-card">
        <i class="fas fa-plus-circle"></i>
        <span>Add Product</span>
        <small>Single item</small>
    </a>
    <a href="{% url 'inventory:product_bulk_add' %}" class="action-card">
        <i class="fas fa-layer-group"></i>
        <span>Bulk Add</span>
        <small>Multiple items</small>
    </a>
    <a href="{% url 'inventory:product_restock' %}" class="action-card">
        <i class="fas fa-truck-loading"></i>
        <span>Restock</span>
        <small>Add quantity</small>
    </a>
    <a href="{% url 'inventory:return_product' %}" class="action-card">
        <i class="fas fa-undo-alt"></i>
        <span>Process Return</span>
        <small>Customer return</small>
    </a>
    <a href="{% url 'inventory:stock_movements' %}" class="action-card">
        <i class="fas fa-history"></i>
        <span>Movements</span>
        <small>View history</small>
    </a>
    <a href="{% url 'inventory:stock_alerts' %}" class="action-card">
        <i class="fas fa-bell"></i>
        <span>Alerts</span>
        <small>{{ low_stock_alerts_count|default:"0" }} active</small>
    </a>
</div>

<!-- Statistics Cards -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon primary">
            <i class="fas fa-boxes"></i>
        </div>
        <div class="stat-value">{{ total_products|default:"0" }}</div>
        <div class="stat-label">Total Products</div>
        <div class="stat-trend">
            <i class="fas fa-arrow-up me-1"></i>{{ new_products_week|default:"0" }} this week
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon success">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-value">{{ available_products|default:"0" }}</div>
        <div class="stat-label">Available</div>
        <div class="stat-trend">
            <i class="fas fa-tag me-1"></i>{{ sold_products|default:"0" }} sold
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon warning">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="stat-value">{{ low_stock_products|default:"0" }}</div>
        <div class="stat-label">Low Stock Items</div>
        <div class="stat-trend down">
            <i class="fas fa-arrow-down me-1"></i>{{ out_of_stock|default:"0" }} out of stock
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon danger">
            <i class="fas fa-undo-alt"></i>
        </div>
        <div class="stat-value">{{ pending_returns_count|default:"0" }}</div>
        <div class="stat-label">Pending Returns</div>
        <div class="stat-trend">
            <i class="fas fa-clock me-1"></i>{{ verified_returns_count|default:"0" }} verified
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row g-4 mb-4">
    <!-- Stock Distribution Chart -->
    <div class="col-xl-4">
        <div class="chart-container">
            <div class="chart-header">
                <h5 class="chart-title">
                    <i class="fas fa-chart-pie"></i>Stock Distribution
                </h5>
                <span class="badge bg-light text-dark">Today</span>
            </div>
            <div class="chart-wrapper">
                <canvas id="stockChart"></canvas>
            </div>
            <div class="mt-3">
                <div class="d-flex justify-content-between mb-2">
                    <span><span class="inventory-status status-normal"></span> Available</span>
                    <span class="fw-bold">{{ available_products|default:"0" }}</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    <span><span class="inventory-status status-low"></span> Low Stock</span>
                    <span class="fw-bold">{{ low_stock_products|default:"0" }}</span>
                </div>
                <div class="d-flex justify-content-between">
                    <span><span class="inventory-status status-critical"></span> Out of Stock</span>
                    <span class="fw-bold">{{ out_of_stock|default:"0" }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Distribution -->
    <div class="col-xl-4">
        <div class="chart-container">
            <div class="chart-header">
                <h5 class="chart-title">
                    <i class="fas fa-tags"></i>Top Categories
                </h5>
                <a href="{% url 'inventory:category_list' %}" class="text-primary small">View All</a>
            </div>
            <div>
                {% for category in stock_by_category|slice:":5" %}
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span class="fw-bold">{{ category.name|truncatechars:20 }}</span>
                        <span>{{ category.total_stock }} units</span>
                    </div>
                    <div class="progress-custom">
                        {% with max_stock=stock_by_category.0.total_stock %}
                        <div class="progress-bar-custom" style="width: {% if max_stock > 0 %}{% widthratio category.total_stock max_stock 100 %}{% else %}0{% endif %}%"></div>
                        {% endwith %}
                    </div>
                </div>
                {% empty %}
                <p class="text-muted text-center py-4">No categories found</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="col-xl-4">
        <div class="chart-container">
            <div class="chart-header">
                <h5 class="chart-title">
                    <i class="fas fa-history"></i>Recent Activity
                </h5>
                <a href="{% url 'inventory:stock_movements' %}" class="text-primary small">View All</a>
            </div>
            <div class="activity-timeline" style="max-height: 300px; overflow-y: auto;">
                {% for entry in recent_movements|slice:":5" %}
                <div class="activity-item">
                    <div class="activity-icon">
                        <i class="fas fa-{% if entry.quantity > 0 %}arrow-down{% else %}arrow-up{% endif %}"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-time">{{ entry.created_at|timesince }} ago</div>
                        <div class="fw-bold">{{ entry.product.display_name|truncatechars:20 }}</div>
                        <div class="d-flex justify-content-between mt-2">
                            <span class="badge {% if entry.quantity > 0 %}bg-success{% else %}bg-danger{% endif %}">
                                {% if entry.quantity > 0 %}+{% endif %}{{ entry.quantity }}
                            </span>
                            <small class="text-muted">{{ entry.created_by.username|default:"System" }}</small>
                        </div>
                    </div>
                </div>
                {% empty %}
                <p class="text-muted text-center py-4">No recent activity</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Stock Alerts and Top Selling -->
<div class="row g-4 mb-4">
    <!-- Stock Alerts -->
    <div class="col-xl-6">
        <div class="table-container">
            <div class="table-header">
                <h5 class="table-title">
                    <i class="fas fa-exclamation-triangle text-warning"></i>
                    Stock Alerts
                    {% if low_stock_alerts_count %}
                    <span class="badge bg-danger ms-2">{{ low_stock_alerts_count }}</span>
                    {% endif %}
                </h5>
                <a href="{% url 'inventory:stock_alerts' %}" class="view-all-link">View All</a>
            </div>
            
            <div style="max-height: 350px; overflow-y: auto;">
                {% for alert in low_stock_alerts %}
                <div class="alert-item {% if alert.product.quantity == 0 %}danger{% else %}warning{% endif %}">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="mb-1 fw-bold">{{ alert.product.display_name }}</h6>
                            <div class="small text-muted mb-2">
                                <i class="fas fa-barcode me-1"></i>{{ alert.product.product_code }}
                                {% if alert.product.sku_value %}
                                | SKU: {{ alert.product.sku_value }}
                                {% endif %}
                            </div>
                            <div class="d-flex gap-3">
                                <span class="badge bg-dark">
                                    Stock: {{ alert.product.quantity }}
                                </span>
                                <span class="badge bg-secondary">
                                    Alert: {{ alert.alert_level }}
                                </span>
                            </div>
                        </div>
                        <div class="btn-group">
                            <a href="{% url 'inventory:product_restock' %}?product={{ alert.product.id }}" 
                               class="btn btn-sm btn-warning" title="Restock">
                                <i class="fas fa-truck"></i>
                            </a>
                            <a href="{% url 'inventory:product_detail' alert.product.id %}" 
                               class="btn btn-sm btn-outline-secondary" title="View">
                                <i class="fas fa-eye"></i>
                            </a>
                        </div>
                    </div>
                    <div class="mt-2">
                        <div class="progress-custom">
                            {% with percentage=alert.product.quantity|default:0 %}
                            <div class="progress-bar-custom" style="width: {% widthratio percentage alert.alert_level 100 %}%"></div>
                            {% endwith %}
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-5">
                    <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                    <p class="mb-0">No stock alerts</p>
                    <small class="text-muted">All products are at healthy levels</small>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Top Selling Products -->
    <div class="col-xl-6">
        <div class="table-container">
            <div class="table-header">
                <h5 class="table-title">
                    <i class="fas fa-chart-line text-success"></i>
                    Top Selling Products
                </h5>
                <a href="#" class="view-all-link">View Sales</a>
            </div>
            
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Sold</th>
                            <th>Revenue</th>
                            <th>Trend</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in top_selling %}
                        <tr>
                            <td>
                                <div class="fw-bold">{{ item.product_name|truncatechars:20 }}</div>
                                <small class="text-muted">{{ item.product_code }}</small>
                            </td>
                            <td>
                                <span class="badge bg-success rounded-pill">{{ item.total_sold }}</span>
                            </td>
                            <td class="fw-bold">KES {{ item.total_revenue|floatformat:0 }}</td>
                            <td>
                                <span class="badge-trend-up">
                                    <i class="fas fa-arrow-up me-1"></i>+12%
                                </span>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" class="text-center py-4 text-muted">
                                <i class="fas fa-shopping-cart fa-2x mb-3 d-block"></i>
                                No sales data available
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Pending Returns -->
<div class="table-container">
    <div class="table-header">
        <h5 class="table-title">
            <i class="fas fa-undo-alt"></i>
            Pending Return Requests
            {% if pending_returns_count %}
            <span class="badge bg-warning ms-2">{{ pending_returns_count }}</span>
            {% endif %}
        </h5>
        <a href="{% url 'inventory:return_list' %}" class="view-all-link">Manage Returns</a>
    </div>

    <div class="row">
        {% for return_request in pending_returns|slice:":4" %}
        <div class="col-md-6">
            <div class="return-card">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <span class="return-status status-{{ return_request.status }}"></span>
                        <span class="fw-bold">#{{ return_request.return_id|truncatechars:8 }}</span>
                    </div>
                    <span class="badge-status 
                        {% if return_request.status == 'submitted' %}badge-pending
                        {% elif return_request.status == 'verified' %}badge-info
                        {% elif return_request.status == 'approved' %}badge-approved
                        {% elif return_request.status == 'rejected' %}badge-rejected
                        {% endif %}">
                        {{ return_request.get_status_display }}
                    </span>
                </div>
                
                <h6 class="mb-2">{{ return_request.product_name }}</h6>
                <p class="small text-muted mb-3">
                    <i class="fas fa-barcode me-1"></i>{{ return_request.product_code }}
                    {% if return_request.sku_value %}
                    | SKU: {{ return_request.sku_value }}
                    {% endif %}
                </p>
                
                <div class="d-flex justify-content-between align-items-center">
                    <div class="small">
                        <i class="far fa-user me-1"></i>{{ return_request.requested_by.username|default:"Unknown" }}
                        <br>
                        <i class="far fa-clock me-1"></i>{{ return_request.requested_at|timesince }} ago
                    </div>
                    
                    <div class="btn-group">
                        <a href="{% url 'inventory:return_detail' return_request.id %}" 
                           class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-eye"></i>
                        </a>
                        {% if return_request.status == 'submitted' %}
                        <a href="{% url 'inventory:return_verify' return_request.id %}" 
                           class="btn btn-sm btn-outline-warning">
                            <i class="fas fa-clipboard-check"></i>
                        </a>
                        {% endif %}
                        {% if return_request.status == 'verified' %}
                        <a href="{% url 'inventory:return_approve' return_request.id %}" 
                           class="btn btn-sm btn-outline-success">
                            <i class="fas fa-check"></i>
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="text-center py-5">
                <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                <p class="mb-0 fw-bold">No pending return requests</p>
                <small class="text-muted">All returns have been processed</small>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Recently Added Products -->
<div class="table-container">
    <div class="table-header">
        <h5 class="table-title">
            <i class="fas fa-clock"></i>
            Recently Added Products
        </h5>
        <a href="{% url 'inventory:product_list' %}" class="view-all-link">View All</a>
    </div>

    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Added</th>
                    <th>Product</th>
                    <th>Code/SKU</th>
                    <th>Category</th>
                    <th>Stock</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for product in recent_products|slice:":5" %}
                <tr>
                    <td>
                        <div class="small fw-bold">{{ product.created_at|date:"H:i" }}</div>
                        <small class="text-muted">{{ product.created_at|date:"M d" }}</small>
                    </td>
                    <td>
                        <div class="fw-bold">{{ product.display_name|truncatechars:25 }}</div>
                        {% if product.brand %}
                            <small class="text-muted">{{ product.brand }} {{ product.model }}</small>
                        {% endif %}
                    </td>
                    <td>
                        <div><span class="badge bg-secondary">{{ product.product_code }}</span></div>
                        {% if product.sku_value %}
                            <small class="text-muted">SKU: {{ product.sku_value }}</small>
                        {% endif %}
                    </td>
                    <td>{{ product.category.name }}</td>
                    <td>
                        {% if product.category.is_single_item %}
                            <span class="badge bg-info">Single</span>
                        {% else %}
                            <span class="badge {% if product.quantity < 10 %}bg-warning{% else %}bg-success{% endif %}">
                                {{ product.quantity }} units
                            </span>
                        {% endif %}
                    </td>
                    <td>
                        <span class="badge-status 
                            {% if product.status == 'available' %}badge-available
                            {% elif product.status == 'lowstock' %}badge-lowstock
                            {% elif product.status == 'outofstock' %}badge-outofstock
                            {% elif product.status == 'sold' %}badge-sold
                            {% endif %}">
                            {{ product.get_status_display }}
                        </span>
                    </td>
                    <td>
                        <div class="btn-group">
                            <a href="{% url 'inventory:product_detail' product.id %}" 
                               class="btn btn-sm btn-outline-primary" title="View">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="{% url 'inventory:product_edit' product.id %}" 
                               class="btn btn-sm btn-outline-secondary" title="Edit">
                                <i class="fas fa-edit"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="text-center py-4 text-muted">
                        <i class="fas fa-box-open fa-2x mb-3 d-block"></i>
                        No products found
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function() {
        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[title]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        });

        // Stock Distribution Chart
        var ctx = document.getElementById('stockChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Available', 'Low Stock', 'Out of Stock'],
                datasets: [{
                    data: [
                        {{ available_products|default:0 }},
                        {{ low_stock_products|default:0 }},
                        {{ out_of_stock|default:0 }}
                    ],
                    backgroundColor: [
                        '#28a745',
                        '#ffc107',
                        '#dc3545'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                cutout: '70%'
            }
        });

        // Auto-refresh every 5 minutes
        setTimeout(function() {
            location.reload();
        }, 300000);

        // Animate numbers
        $('.stat-value').each(function() {
            var $this = $(this);
            var countTo = parseInt($this.text().replace(/,/g, ''));
            
            if (!isNaN(countTo) && countTo > 0) {
                $({ countNum: 0 }).animate({ countNum: countTo }, {
                    duration: 1000,
                    easing: 'swing',
                    step: function() {
                        $this.text(Math.floor(this.countNum));
                    },
                    complete: function() {
                        $this.text(this.countNum);
                    }
                });
            }
        });
    });
</script>
{% endblock %}